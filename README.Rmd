---
title: "Identifying Samples with High Technical Variation"
author: "Angela Sofia Burkhart Colorado"
date: '2022-08-16'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Description

This script will identify 16S sequencing samples with high technical variation. Right now it takes distance matrices generated 
through standard dada2 pipeline in QIIME2. The four kinds of distances metrics are Jaccard, Bray Curtis, Unweighted and Weighted Unifrac. Any and all of these matrices can be used in this implementation. With those matrices this script will output density curves containing two distributions. The first will be of distances found between more closely related samples and the second will be of distances between samples that were less closely related. 

## Workflow 

# Arguments 

Should one want information on a distribution of **one** distance metric, further arguments that are needed include: 
1. Metric (or method) used **e.g. Jaccard** 
2. subset_ID (delimited to distinguish between related and unrelated samples) **e.g. noodle**

Should one want information on **all four** distance matrices, the only other argument needed is: 
1. subset_ID (delimited to distinguish between related and unrelated samples) **e.g. noodle**

When plotting distributions there are four arguments: 
1. Dataframe containing distributions 
2. column name of delimiter **e.g. Within_noodle** (this column will always begin with **Within_**)
3. y limit for the plot (integer)
4. Sampling depth that was used when calculating the matrices in QIIME 

To plot summary statistics the only arguments needed are **1 & 2** of the arguments used in the plots. 

# Inputs 
To run this script you will need two file types: 
1. metadata file (.tsv)
2. distance matrix file (.txt)

Metadata example: 

```{r, echo=FALSE}
full_meta <- metadata_readin(metadata_fp)
test_matrix <- get_matrix(jaccard_fp)
test_distribution <- distance_data_by_relatedness(test_matrix, 
                                                  full_meta, 
                                                  method = "Jaccard", 
                                                  subset_ID = "noodle")
head(full_meta)
```


Distance matrix example: 

```{r}
head(test_matrix)
```


## Outputs 
The following is an examples of the distance distribution dataframe output: 

```{r }
head(test_distribution)
```

# Plots

Density plots generated appear as the following: 

```{r pressure, echo=FALSE}
plot_by_relatedness(test_combo, "Within_noodle", "15", "1045")
```
Tables and a box plot can also be output to summarize the distributions generated. 

```{r, echo=FALSE}
summary_of_distributions(test_combo, "Within_noodle")
```


## Installation and Dependencies
You must have R installed. This was written in R-4.1.2 on a Windows-based operatin system. Packages readr, dplyr, ggplot2, and ggpubr will be required. 

## Contact 
Angela Sofia Burkhart Colorado - angelasofia.burkhartcolorado@cuanschutz.edu
Project Link - https://github.com/acolorado1/IdenitifyingSamplesWithHighTechnicalVariation.git

